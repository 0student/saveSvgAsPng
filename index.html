<!DOCTYPE html>

<link rel=stylesheet href=bootstrap.min.css />
<style>
  h2 {
    margin-top: 0;
  }

  ul {
    list-style-type: none;
  }

  ul li {
    padding: 30px 20px;
    border-bottom: 1px dashed gray;
  }

  svg, img {
    border: 1px solid lightgray;
  }
</style>

<div class=container>
  <ul>
    <li id=filereader>
      <h2>Load from hard drive</h2>
      <input type=file id=file name="files[]" />
      <div class=load-target></div>

      <h3>Preview</h3>
      <button class=save>Save as PNG</button>
      <div class=preview>No file selected.</div>
    </li>

    <li id=inline>
      <h2>Inline</h2>
      <svg class=source width=200 height=200>
        <rect x=50 y=50 width=100 height=100></rect>
      </svg>

      <h3>Preview</h3>
      <button class=save>Save as PNG</button>
      <div class=preview></div>
    </li>
  </ul>
</div>

<script src=http://code.jquery.com/jquery-latest.min.js></script>
<script src=saveSvgAsPng.js></script>
<script>
  function handleFileSelect(evt) {
    var files = evt.target.files;
    for (var i = 0, f; f = files[i]; i++) {
      var reader = new FileReader();
      reader.onload = (function(file) {
        return function(e) {
          $('#filereader .load-target').html(e.target.result);
          svgAsDataUri($('#filereader .load-target svg')[0], null, function(uri) {
            $('#filereader .preview').html('<img src="' + uri + '" />');
          });
          $('#filereader .save').click(function() {
            saveSvgAsPng($('#filereader .load-target svg')[0], 'test.png');
          });
        }
      })(f);
      reader.readAsText(f);
    }
  }

  if (window.File && window.FileReader && window.FileList && window.Blob) {
    document.getElementById('file').addEventListener('change', handleFileSelect, false);
  }

  svgAsDataUri($('#inline svg')[0], null, function(uri) {
    $('#inline .preview').html('<img src="' + uri + '" />');
  });

  $('#inline .save').click(function() {
    saveSvgAsPng($('#inline svg')[0], 'test.png');
  });
</script>
