<!DOCTYPE html>

<link rel=stylesheet href=bootstrap.min.css />
<style>
  h2, h3 {
    margin-top: 0;
  }

  h3 .btn {
    margin-top: -8px;
  }

  ul {
    list-style-type: none;
  }

  ul li {
    padding: 30px 20px;
    border-bottom: 1px dashed gray;
  }

  svg, img {
    border: 1px solid lightgray;
  }
</style>

<div class=container>
  <ul>
    <li id=filereader>
      <div class=row>
        <div class=col-md-6>
          <h2>Load from your hard drive</h2>
        </div>

        <div class=col-md-6>
          <h3>Preview <button class="save btn">Save as PNG</button></h3>
        </div>
      </div>

      <div class=row>
        <div class=col-md-6>
          <input type=file id=file name="files[]" />
          <div class=load-target></div>
        </div>

        <div class=col-md-6>
          <div class=preview>No file selected.</div>
        </div>
      </div>
    </li>

    <li id=inline>
      <div class=row>
        <div class=col-md-6>
          <h2>Directly in the HTML</h2>
        </div>

        <div class=col-md-6>
          <h3>Preview <button class="save btn">Save as PNG</button></h3>
        </div>
      </div>

      <div class=row>
        <div class=col-md-6>
          <svg width=200 height=200>
            <rect x=50 y=50 width=100 height=100></rect>
          </svg>
        </div>

        <div class=col-md-6>
          <div class=preview></div>
        </div>
      </div>
    </li>

    <li id=embedded-png>
      <div class=row>
        <div class=col-md-6>
          <h2>With linked PNG images</h2>
        </div>

        <div class=col-md-6>
          <h3>Preview <button class="save btn">Save as PNG</button></h3>
        </div>
      </div>

      <div class=row>
        <div class=col-md-6>
          <svg width=200 height=200>
            <image xlink:href=image.png x=50 y=50 width=100 height=100></image>
          </svg>
        </div>

        <div class=col-md-6>
          <div class=preview></div>
        </div>
      </div>
    </li>

    <li id=embedded-svg>
      <div class=row>
        <div class=col-md-6>
          <h2>With linked SVG images</h2>
        </div>

        <div class=col-md-6>
          <h3>Preview <button class="save btn">Save as PNG</button></h3>
        </div>
      </div>

      <div class=row>
        <div class=col-md-6>
          <svg width=200 height=200>
            <image xlink:href=test.svg x=50 y=50 width=100 height=100></image>
          </svg>
        </div>

        <div class=col-md-6>
          <div class=preview></div>
        </div>
      </div>
    </li>
  </ul>
</div>

<script src=http://code.jquery.com/jquery-latest.min.js></script>
<script src=saveSvgAsPng.js></script>
<script>
  function handleFileSelect(evt) {
    var $el = $('#filereader');
    var files = evt.target.files;
    for (var i = 0, f; f = files[i]; i++) {
      var reader = new FileReader();
      reader.onload = (function(file) {
        return function(e) {
          $el.find('.load-target').html(e.target.result);
          svgAsDataUri($el.find('.load-target svg')[0], null, function(uri) {
            $el.find('input').hide()
            $el.find('.preview').html('<img src="' + uri + '" />');
          });
          $el.find('.save').click(function() {
            saveSvgAsPng($el.find('.load-target svg')[0], 'test.png');
          });
        }
      })(f);
      reader.readAsText(f);
    }
  }

  function inlineTest($el) {
    var svg = $el.find('svg')[0];
    svgAsDataUri(svg, null, function(uri) {
      $el.find('.preview').html('<img src="' + uri + '" />');
    });

    $el.find('.save').click(function() {
      saveSvgAsPng(svg, 'test.png');
    });
  }

  if (window.File && window.FileReader && window.FileList && window.Blob) {
    document.getElementById('file').addEventListener('change', handleFileSelect, false);
  }

  inlineTest($('#inline'));
  inlineTest($('#embedded-png'));
  inlineTest($('#embedded-svg'));
</script>
